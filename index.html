<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <!-- This line is essential for the charts to work -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <header>
        <h1>ShopFlow Interactive Analytics Dashboard</h1>
    </header>

    <main>
        <!-- KPI Section -->
        <div class="kpi-container">
            <div class="kpi-card">
                <h2>Total Revenue</h2>
                <!-- IMPORTANT: Replace these values with the output from your Colab script -->
                <p>$6,125.41</p>
            </div>
            <div class="kpi-card">
                <h2>Top Segment Avg. LTV</h2>
                <p>$350.00</p>
            </div>
            <div class="kpi-card">
                <h2>Cart Recovery Rate</h2>
                <p>50.0%</p>
            </div>
        </div>

        <!-- Search Section -->
        <div class="search-container">
            <h2>Search Products</h2>
            <input type="text" id="searchInput" placeholder="Enter product name to search...">
            <div id="resultsContainer"></div>
        </div>

        <!-- Chart Grid -->
        <div class="chart-grid">
            <div class="chart-card">
                <!-- PASTE CHART 1 (Customer Segmentation) HERE -->
                <!-- Open the 1_customer_segmentation.html file you exported, copy the <div>...</div> block, and paste it here. -->
            </div>
            <div class="chart-card">
                <!-- PASTE CHART 2 (Product Performance) HERE -->
                <!-- Open the 2_product_performance.html file, copy its <div>, and paste it here. -->
            </div>
            <div class="chart-card large-chart">
                <!-- PASTE CHART 3 (Monthly Revenue) HERE -->
                <!-- Open the 3_monthly_revenue.html file, copy its <div>, and paste it here. -->
            </div>
            <div class="chart-card">
                <!-- PASTE CHART 5 (Support Analysis) HERE -->
                <!-- Open the 5_support_analysis.html file, copy its <div>, and paste it here. -->
            </div>
            <div class="chart-card">
                 <!-- PASTE CHART 9 (Cross-Selling Heatmap) HERE -->
                 <!-- Open the 9_cross_selling.html file, copy its <div>, and paste it here. -->
            </div>
        </div>
    </main>

    <!-- JavaScript for the Search Functionality -->
    <script>
        const searchInput = document.getElementById('searchInput');
        const resultsContainer = document.getElementById('resultsContainer');
        let allProducts = []; // This will hold our product data from products.json

        // 1. Fetch and load the product data as soon as the page loads
        async function loadProductData() {
            try {
                const response = await fetch('products.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allProducts = await response.json();
                console.log(`Successfully loaded ${allProducts.length} products for search.`);
            } catch (error) {
                resultsContainer.innerHTML = `<p style="color: red;">Error: Could not load product data.</p>`;
                console.error("Fetch error:", error);
            }
        }

        // 2. Function to perform the search and display results
        function performSearch() {
            const query = searchInput.value.toLowerCase().trim();

            if (!query) {
                resultsContainer.innerHTML = ''; // Clear results if search box is empty
                return;
            }

            // Filter the loaded product data based on the query
            const filteredProducts = allProducts.filter(product => {
                return product.product_name.toLowerCase().includes(query);
            });

            // 3. Build and display the HTML for the results
            if (filteredProducts.length === 0) {
                resultsContainer.innerHTML = '<p>No products found.</p>';
                return;
            }

            let tableHTML = '<table><thead><tr><th>Product Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Description</th></tr></thead><tbody>';
            for (const product of filteredProducts) {
                tableHTML += `<tr>
                    <td>${product.product_name}</td>
                    <td>${product.category}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.stock_quantity}</td>
                    <td>${product.description}</td>
                </tr>`;
            }
            tableHTML += '</tbody></table>';
            resultsContainer.innerHTML = tableHTML;
        }

        // 4. Add event listeners
        searchInput.addEventListener('keyup', performSearch); // Search as the user types
        document.addEventListener('DOMContentLoaded', loadProductData); // Load data when page is ready
    </script>
</body>
</html>
